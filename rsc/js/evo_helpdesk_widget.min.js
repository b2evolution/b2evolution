var evo_helpdesk_widget={defaults:{site_url:null,collection:null,title:"Help",width:"370px",height:"450px",default_tag:null,default_slug:null,results_per_page:25,image_link:!0,image_size:"fit-640x480",icon_sticker:'<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50,5C25.2,5,5,25.2,5,50s20.2,45,45,45s45-20.2,45-45S74.8,5,50,5z M50,7c11.5,0,21.9,4.5,29.7,11.9L67.3,31.3  c-4.5-4.2-10.6-6.8-17.3-6.8s-12.7,2.6-17.3,6.8L20.3,18.9C28.1,11.5,38.5,7,50,7z M73.4,50c0,12.9-10.5,23.4-23.4,23.4  S26.6,62.9,26.6,50S37.1,26.6,50,26.6S73.4,37.1,73.4,50z M7,50c0-11.5,4.5-21.9,11.9-29.7l12.4,12.4c-4.2,4.5-6.8,10.6-6.8,17.3  s2.6,12.7,6.8,17.3L18.9,79.7C11.5,71.9,7,61.5,7,50z M50,93c-11.5,0-21.9-4.5-29.7-11.9l12.4-12.4c4.5,4.2,10.6,6.8,17.3,6.8  s12.7-2.6,17.3-6.8l12.4,12.4C71.9,88.5,61.5,93,50,93z M81.1,79.7L68.7,67.3c4.2-4.5,6.8-10.6,6.8-17.3s-2.6-12.7-6.8-17.3  l12.4-12.4C88.5,28.1,93,38.5,93,50S88.5,71.9,81.1,79.7z"/></svg>',icon_search:'<svg viewBox="0 0 90 100" xmlns="http://www.w3.org/2000/svg"><path d="M93.667,93.66711a4.54882,4.54882,0,0,0,0-6.43475L70.94507,64.51221A36.9358,36.9358,0,1,0,64.51,70.94672L87.23218,93.66711a4.54887,4.54887,0,0,0,6.43481,0ZM41.87268,69.64435A27.77146,27.77146,0,1,1,69.64417,41.87286,27.80231,27.80231,0,0,1,41.87268,69.64435Z"/></svg>',icon_close:'<svg viewBox="0 0 15 15" xmlns="http://www.w3.org/2000/svg"><line x1="1" y1="15" x2="15" y2="1"></line><line x1="1" y1="1" x2="15" y2="15"></line></svg>',icon_permalink:'<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M73.7883228,16 L44.56401,45.2243128 C42.8484762,46.9398466 42.8459918,49.728257 44.5642987,51.4465639 C46.2791092,53.1613744 49.0684023,53.1650001 50.7865498,51.4468526 L80,22.2334024 L80,32.0031611 C80,34.2058797 81.790861,36 84,36 C86.2046438,36 88,34.2105543 88,32.0031611 L88,11.9968389 C88,10.8960049 87.5527117,9.89722307 86.8294627,9.17343595 C86.1051125,8.44841019 85.1063303,8 84.0031611,8 L63.9968389,8 C61.7941203,8 60,9.790861 60,12 C60,14.2046438 61.7894457,16 63.9968389,16 L73.7883228,16 L73.7883228,16 Z M88,56 L88,36.9851507 L88,78.0296986 C88,83.536144 84.0327876,88 79.1329365,88 L16.8670635,88 C11.9699196,88 8,83.5274312 8,78.0296986 L8,17.9703014 C8,12.463856 11.9672124,8 16.8670635,8 L59.5664682,8 L40,8 C42.209139,8 44,9.790861 44,12 C44,14.209139 42.209139,16 40,16 L18.2777939,16 C17.0052872,16 16,17.1947367 16,18.668519 L16,77.331481 C16,78.7786636 17.0198031,80 18.2777939,80 L77.7222061,80 C78.9947128,80 80,78.8052633 80,77.331481 L80,56 C80,53.790861 81.790861,52 84,52 C86.209139,52 88,53.790861 88,56 L88,56 Z"/></svg>'},init:function(a){if(!0!==this.initialized)return this.initialized=!0,this.options=jQuery.extend({},this.defaults,a),null===this.options.site_url?void alert("Please define site URL for evo helpdesk widget!"):null===this.options.collection?void alert("Please define collection for evo helpdesk widget!"):void jQuery(document).ready(function(){jQuery("body").append('<div id="evo_helpdesk_widget"><div id="evo_helpdesk_widget__sticker">'+evo_helpdesk_widget.options.icon_sticker+'</div><div id="evo_helpdesk_widget__window"><div id="evo_helpdesk_widget__header"><div id="evo_helpdesk_widget__icon_search">'+evo_helpdesk_widget.options.icon_search+"</div><div>"+evo_helpdesk_widget.options.title+'</div><div id="evo_helpdesk_widget__icon_close">'+evo_helpdesk_widget.options.icon_close+'</div></div><div id="evo_helpdesk_widget__body"><div id="evo_helpdesk_widget__results_list"><form id="evo_helpdesk_widget__search_form"><div><div><input type="text"></div><div><button type="submit" class="evo_helpdesk_widget__button">Search</button></div><div><button type="button" class="evo_helpdesk_widget__button">Clear</button></div></div></form><div id="evo_helpdesk_widget__posts_list"></div></div><div id="evo_helpdesk_widget__result_details"></div><button id="evo_helpdesk_widget__results_back" class="evo_helpdesk_widget__button">&laquo; Back</button></div></div></div>'),jQuery("#evo_helpdesk_widget__window").css({width:evo_helpdesk_widget.options.width,height:evo_helpdesk_widget.options.height}),jQuery(window).resize(evo_helpdesk_widget.update_widget_size),evo_helpdesk_widget.update_widget_size(),jQuery("#evo_helpdesk_widget__sticker").click(evo_helpdesk_widget.show),jQuery("#evo_helpdesk_widget__icon_search").click(evo_helpdesk_widget.switch_layout),jQuery("#evo_helpdesk_widget__icon_close").click(evo_helpdesk_widget.hide),jQuery(document).on("submit","#evo_helpdesk_widget__search_form",evo_helpdesk_widget.search),jQuery(document).on("click","#evo_helpdesk_widget__search_form button[type=button]",evo_helpdesk_widget.reset),jQuery(document).on("click","#evo_helpdesk_widget__posts_list a:not([target])",evo_helpdesk_widget.load_item),jQuery(document).on("click","#evo_helpdesk_widget__results_back",evo_helpdesk_widget.switch_layout)})},update_widget_size:function(){jQuery("#evo_helpdesk_widget").css("height",jQuery("#evo_helpdesk_widget__window").is(":visible")&&parseInt(evo_helpdesk_widget.options.height)>jQuery("#evo_helpdesk_widget").height()?"100%":"initial")},show:function(a){jQuery("#evo_helpdesk_widget__window").show(),jQuery("#evo_helpdesk_widget__sticker").hide(),jQuery("#evo_helpdesk_widget__search_form input").focus(),evo_helpdesk_widget.update_widget_size(),!0!==evo_helpdesk_widget.shown&&(evo_helpdesk_widget.shown=!0,null!==evo_helpdesk_widget.options.default_slug?evo_helpdesk_widget.load_item(evo_helpdesk_widget.options.collection,evo_helpdesk_widget.options.default_slug):evo_helpdesk_widget.load_items())},hide:function(a){jQuery("#evo_helpdesk_widget__window").hide(),jQuery("#evo_helpdesk_widget__sticker").show(),evo_helpdesk_widget.update_widget_size()},search:function(a,b){var c="object"==typeof a;return c&&void 0!==b||(b=c?jQuery("#evo_helpdesk_widget__search_form input").val():a),evo_helpdesk_widget.switch_layout("results"),evo_helpdesk_widget.rest_api_request("collections/"+evo_helpdesk_widget.options.collection+"/search/"+b,"#evo_helpdesk_widget__posts_list",{per_page:evo_helpdesk_widget.options.results_per_page},function(a){if(0===a.found||0===a.results.length)var b='<div class="evo_helpdesk_widget__text_danger">Sorry, we could not find anything matching your request, please try to broaden your search.</div>';else{var b="<ul>";for(var c in a.results){var d=a.results[c];b+="<li>","item"==d.kind?b+='<a href="#" data-id="'+d.id+'" data-urlname="'+evo_helpdesk_widget.options.collection+'" class="evo_helpdesk_widget__link">'+d.title+"</a>":b+=d.kind+': <a href="'+d.permalink+'" target="_blank" title="Open in new tab" class="evo_helpdesk_widget__link">'+d.title+"</a>",b+="</li>"}b+="</ul>"}return b}),c&&a.preventDefault(),!1},reset:function(a){return evo_helpdesk_widget.switch_layout("results"),jQuery("#evo_helpdesk_widget__search_form input").val(""),evo_helpdesk_widget.load_items(),"object"==typeof a&&a.preventDefault(),!1},load_items:function(a,b){void 0===a&&(a=evo_helpdesk_widget.options.collection);var c={per_page:evo_helpdesk_widget.options.results_per_page};void 0!==b?c.tag=b:null!==evo_helpdesk_widget.options.default_tag&&(c.tag=evo_helpdesk_widget.options.default_tag),evo_helpdesk_widget.rest_api_request("collections/"+a+"/posts","#evo_helpdesk_widget__posts_list",c,function(b){var c="<ul>";for(var d in b.items){var e=b.items[d];c+='<li><a href="#" data-id="'+e.id+'" data-urlname="'+a+'" class="evo_helpdesk_widget__link">'+e.title+"</a></li>"}return c+="</ul>"}),evo_helpdesk_widget.loaded_items=!0},load_item:function(a,b,c){var d="object"==typeof a;return d&&void 0!==c||(c=d?jQuery(a.target).data("id"):b,b=d?jQuery(a.target).data("urlname"):a),evo_helpdesk_widget.switch_layout("item"),evo_helpdesk_widget.rest_api_request("collections/"+b+"/items/"+c,"#evo_helpdesk_widget__result_details",{content_params:{before_image:'<figure class="evo_helpdesk_widget__image">',before_image_legend:'<figcaption class="evo_helpdesk_widget__image_caption">',after_image_legend:"</figcaption>",after_image:"</figure>",before_gallery:'<div class="evo_helpdesk_widget__gallery">',after_gallery:"</div>",gallery_cell_start:'<div class="evo_helpdesk_widget__gallery_image">',gallery_cell_end:"</div>",image_link_to:evo_helpdesk_widget.options.image_link?"original":"",gallery_image_link_to:evo_helpdesk_widget.options.image_link?"original":"",image_size:evo_helpdesk_widget.options.image_size}},function(a){return'<h2><a href="'+a.URL+'" target="_blank" class="evo_helpdesk_widget__link" title="Open in new tab"><span class="evo_helpdesk_widget__icon_permalink">'+evo_helpdesk_widget.options.icon_permalink+"</span>"+a.title+"</a></h2>"+a.content}),d&&a.preventDefault(),!1},switch_layout:function(a,b){var c="object"==typeof a;switch(c&&void 0!==b||(b=c?void 0===b?"results":"layout":a),jQuery("#evo_helpdesk_widget__results_list").toggle("results"==b),jQuery("#evo_helpdesk_widget__result_details, #evo_helpdesk_widget__results_back").toggle("item"==b),b){case"results":jQuery("#evo_helpdesk_widget__search_form input").focus(),evo_helpdesk_widget.loaded_items||evo_helpdesk_widget.load_items();break;case"item":jQuery("#evo_helpdesk_widget__result_details").html("")}return c&&a.preventDefault(),!1},rest_api_request:function(request,content_selector,params_func,func_method,method){var params=params_func,func=func_method;"function"==typeof params_func&&(func=params_func,params={},method=func_method),void 0===method&&(method="GET");var rest_api_url=evo_helpdesk_widget.options.site_url;"/"!=rest_api_url.slice(-1)&&(rest_api_url+="/"),rest_api_url+="api/v1/",jQuery("#evo_helpdesk_widget__body").addClass("evo_helpdesk_widget_loading").append('<div class="evo_helpdesk_widget_loader">loading...</div>'),jQuery.ajax({contentType:"application/json; charset=utf-8",type:method,url:rest_api_url+request,data:params}).then(function(data,textStatus,jqXHR){"object"==typeof jqXHR.responseJSON&&evo_helpdesk_widget.rest_api_end_loading(content_selector,eval(func)(data,textStatus,jqXHR))},function(a){var b=void 0===a.responseJSON?a.statusText:a.responseJSON;if(void 0===b.code)b='<div class="evo_helpdesk_widget__text_error">Unknown error: '+b+"</div>";else switch(b.data.status){case 200:b="<div>"+b.message+"</div>";break;default:b='<div class="evo_helpdesk_widget__text_error">'+b.message+"</div>"}evo_helpdesk_widget.rest_api_end_loading(content_selector,b)})},rest_api_end_loading:function(a,b){jQuery(a).html(b),jQuery("#evo_helpdesk_widget__body").removeClass("evo_helpdesk_widget_loading").find(".evo_helpdesk_widget_loader").remove()}};